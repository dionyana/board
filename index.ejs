<% 
    if (typeof(error) == "undefined") {
                error = '';
    }
%>
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>投稿表示 - Board</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="/css/bootstrap.min.css">
    </head>
    <body>
        <nav class="navbar bg-light">
            <a class="navbar-brand" href="/index/">Board</a>
            <% if (login_user) { %>
                <span class="navbar-text">
                    <%= login_user %>でログイン中
                </span>
            <% } %>
                <ul class="nav">
                    <% if (login_user) { %>
                        <li class="nav-item">
                                <a href="/write" class="nav-link">新規投稿</a>
                            </li>
                        <li class="nav-item">
                            <a href="/token" class="nav-link">トークン発行</a>
                        </li>
                        <li class="nav-item">
                            <a href="/logout" class="nav-link">ログアウト</a>
                        </li>
                    <% } else { %>
                        <li class="nav-item">
                            <a href="/login" class="nav-link">ログイン</a>
                        </li>
                    <% } %>
                </ul>
        </nav>
        <div class="container">
            <p>
                <%= error %>
            <%  if (message) { %>
                <%= message %>
            <%  } %>
            </p>
            <hr>
            <%  if (link_all) { %>
            <%      for (var i = 1; i < parseInt(link_all) + 1; i++) { %>
                        <a class="navbar-brand" href="/index/<%= i %>"><%= i %></a>
                <%  } %>
            <%  } %>
            <dl>
            <% posts.forEach(function(post) { %>
                <dt>
                    <span class="name"><%= post.name %></span>
                    <span class="time"><%= post.time.format('YYYY-MM-DD HH:mm') %></span>
                </dt>
                <% if (post.img) { %>
                    <dd>
                        <img src="<%= post.img %>" name="image" width="100" height="100">
                    </dd>
                <%  }  %>
                <%  
                    if (post.message) {
                        // <をエスケープ
                        let message = post.message.replace(/</g, '&lt;');
                        // 改行を<br>に変換
                        message = message.replace(/\n/g, '<br>'); 
                %>
                    <dd>
                        <%- message %>
                    </dd>
                <%  }  %>
                <% if (login_user == post.user_id) { %>
                    <dd>
                        <div class="form-group">
                            <form action="/delete/<%= post.post_id %>" method="POST">
                                <input type="submit" class="btn btn-primary" value="削除">
                            </form>
                        </div>
                    </dd>
                <%  }  %>
            <% }); %>
            </dl>
        </div>
    </body>
</html>